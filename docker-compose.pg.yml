# Option 1: ThingsBoard + PostgreSQL (entities + telemetry)
# Quick start (PowerShell):
#   docker compose -f docker-compose.pg.yml up -d --build
#   docker compose -f docker-compose.pg.yml down

services:
  postgres:
    image: postgres:15-alpine
    container_name: postgres
    hostname: postgres
    environment:
      POSTGRES_DB: ${PG_THINGSBOARD_DB:-thingsboard}
      POSTGRES_USER: ${PG_THINGSBOARD_USER:-thingsboard}
      POSTGRES_PASSWORD: ${PG_THINGSBOARD_PASSWORD:-thingsboard}
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - ontobot-network

  mytb:
    image: devmanenvision/my-thingsboard:1.1
    container_name: thingsboard
    hostname: thingsboardhost
    depends_on:
      - postgres
    environment:
      TB_QUEUE_TYPE: in-memory
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/${PG_THINGSBOARD_DB:-thingsboard}
      SPRING_DATASOURCE_USERNAME: ${PG_THINGSBOARD_USER:-thingsboard}
      SPRING_DATASOURCE_PASSWORD: ${PG_THINGSBOARD_PASSWORD:-thingsboard}
      DATABASE_TS_TYPE: sql
    ports:
      - "8082:9090"   # TB Web UI at http://localhost:8082
      - "1883:1883"
      - "7070:7070"
      - "5683-5688:5683-5688/udp"
      - "8081:8081"
    volumes:
      - mytb-pg-data:/data
      - mytb-pg-logs:/var/log/thingsboard
    networks:
      - ontobot-network

networks:
  ontobot-network:

volumes:
  postgres-data:
  mytb-pg-data:
  mytb-pg-logs:
