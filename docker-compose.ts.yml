# Option 2: ThingsBoard + TimescaleDB (Postgres with Timescale extension)
# Quick start (PowerShell):
#   docker compose -f docker-compose.ts.yml up -d --build
#   docker compose -f docker-compose.ts.yml down

services:
  timescaledb:
    image: timescale/timescaledb:latest-pg14
    container_name: timescaledb
    hostname: timescaledb
    environment:
      POSTGRES_DB: ${PG_THINGSBOARD_DB:-thingsboard}
      POSTGRES_USER: ${PG_THINGSBOARD_USER:-thingsboard}
      POSTGRES_PASSWORD: ${PG_THINGSBOARD_PASSWORD:-thingsboard}
      TIMESCALEDB_TELEMETRY_ENABLED: "false"
    ports:
      - "5433:5432"
    volumes:
      - timescaledb-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U thingsboard -d thingsboard"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    networks:
      - ontobot-network

  mytb:
    image: devmanenvision/my-thingsboard:1.1
    container_name: thingsboard
    hostname: thingsboardhost
    depends_on:
      timescaledb:
        condition: service_healthy
    environment:
      TB_QUEUE_TYPE: in-memory
      SPRING_DATASOURCE_URL: jdbc:postgresql://timescaledb:5432/${PG_THINGSBOARD_DB:-thingsboard}
      SPRING_DATASOURCE_USERNAME: ${PG_THINGSBOARD_USER:-thingsboard}
      SPRING_DATASOURCE_PASSWORD: ${PG_THINGSBOARD_PASSWORD:-thingsboard}
      DATABASE_TS_TYPE: sql
    ports:
      - "8082:9090"   # TB Web UI at http://localhost:8082
      - "1883:1883"
      - "7070:7070"
      - "5683-5688:5683-5688/udp"
      - "8081:8081"
    volumes:
      - mytb-ts-data:/data
      - mytb-ts-logs:/var/log/thingsboard
    networks:
      - ontobot-network

networks:
  ontobot-network:

volumes:
  timescaledb-data:
  mytb-ts-data:
  mytb-ts-logs:



# System Administrator
# Default system administrator account:

# login - sysadmin@thingsboard.org.
# password - sysadmin.

# Demo Tenant
# Default tenant administrator account:

# login - tenant@thingsboard.org.
# password - tenant.